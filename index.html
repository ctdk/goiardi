
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Goiardi</title>
  <meta name="author" content="Jeremy Bingham">

  
  <meta name="description" content="It&rsquo;s true, goiardi now has a new website to call home. This Github Pages site will stay up indefinitely, since it&rsquo;s not hurting anything &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ctdk.github.io/goiardi">
  <link href="/goiardi/favicon.png" rel="icon">
  <link href="/goiardi/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/goiardi/atom.xml" rel="alternate" title="Goiardi" type="application/atom+xml">
  <script src="/goiardi/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/goiardi/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6397614-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/goiardi/">Goiardi</a></h1>
  
    <h2>The one-eyed fanged yak is becoming on you.</h2>
  
  </div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/goiardi/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ctdk.github.io/goiardi" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/goiardi/">Blog</a></li>
  <li><a href="/goiardi/blog/archives">Archives</a></li>
  <li><a href="/goiardi/docs">Documentation</a></li>
  <li><a href="https://github.com/ctdk/goiardi">Source</a></li>
  <li><a href="http://time.to.pullthepl.ug">Time To Pull The Plug</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/12/12/goiardi-has-a-new-home/">Goiardi Has a New Home</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-12-12T09:08:26-08:00" pubdate data-updated="true">Dec 12<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s true, goiardi now has a new website to call home. This Github Pages site will stay up indefinitely, since it&rsquo;s not hurting anything by being here, but future goiardi updates will be found at <a href="http://goiardi.gl"><a href="http://goiardi.gl">http://goiardi.gl</a></a>. It also features a new (but probably temporary) logo for goiardi.</p>

<p>I switched the goiardi site from using <a href="http://octopress.org">Octopress</a> to <a href="http://gohugo.io/">Hugo</a>, a static site generator written in Go. It&rsquo;s pretty nice to use, and it&rsquo;s <em>fast</em>.</p>

<p>I&rsquo;m going to spend some time sprucing the new site up some and adding content where appropriate, but it&rsquo;s a good place to roll out. Thanks, and take a look at it if you feel the yen.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/11/23/goiardi-version-0-dot-8-2-can-shaped-cranberry-sauce/">Goiardi Version 0.8.2 - Can-shaped Cranberry Sauce</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-23T11:29:27-08:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a minor release fixing a couple of small issues that popped up that seemed important enough that they probably shouldn&rsquo;t wait until 1.0.0 comes out.</p>

<p><a href="https://github.com/ctdk/goiardi/releases/tag/v0.8.2">Goiardi version 0.8.2</a> fixes a couple of typos, one with checking errors when checking for the existence of a client in SQL mode, and one for the option to use postgres in the sample config file. The <code>use-postgresql</code> option was documented correctly elsewhere, but was listed incorrectly as <code>use-postgres</code> in the sample config file. This release also adds some checks to make sure the directory given for the local filestore exists, and is a directory.</p>

<p>Binaries are up on the release page, as usual.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/10/15/goiardi-version-0-dot-8-1-and-schob-version-0-dot-1-1-hand-of-ishtar-hand-of-nergal/">Goiardi Version 0.8.1 and Schob Version 0.1.1 - Hand of Ishtar, Hand of Nergal</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-15T13:17:58-07:00" pubdate data-updated="true">Oct 15<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In ancient Mesopotamia, diseases were often referred to as being the &ldquo;hand&rdquo; of some god. The hand of Nergal was a plague of some kind, while the hand of Ishtar was some kind of STD. Ishtar is generally identified with the Greek Aphrodite and Roman Venus as a goddess of love (although she was by no means identical to Aphrodite and Venus), so the name&rsquo;s quite appropriate. The word &ldquo;venereal&rdquo; ultimately derives from &ldquo;Venus&rdquo;, after all.</p>

<p>These are two minor releases. <a href="https://github.com/ctdk/goiardi/releases/tag/v0.8.1">Goiardi version 0.8.1</a> moves the bulk of the documentation from the README to <a href="http://goiardi.readthedocs.org/en/latest/index.html">readthedocs</a>, where it should be much easier to read and work on, fixes a small issue with the postgres SQL dump file, and disables SSLv3. <a href="https://github.com/ctdk/schob/releases/tag/v0.1.1">Schob 0.1.1</a>  adds a fix to allow building schob on 32 bit platforms and on Windows, and updates links to the goiardi shovey documentation.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/09/29/goiardi-version-0-dot-8-0-plus-shovey-hojotoho-hojotoho/">Goiardi Version 0.8.0 (Plus Shovey) - Hojotoho! Hojotoho!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-29T23:25:23-07:00" pubdate data-updated="true">Sep 29<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In honor of the upcoming <a href="https://www.getchef.com/summit/">Chef Summit</a>, there are new releases from goiardi and friends. This officially brings out <a href="https://github.com/ctdk/goiardi#shovey">shovey</a>, the goiardi push jobs facility, to the world.</p>

<p>Because of the relative complexity of shovey, there are actually three releases here:</p>

<ul>
<li><a href="https://github.com/ctdk/goiardi/releases/tag/v0.8.0">goiardi v0.8.0 &ndash; Hojotoho! Hojotoho!</a></li>
<li><a href="https://github.com/ctdk/schob/releases/tag/v0.1.0">schob v0.1.0 &ndash; Heiaha! Heiaha!</a></li>
<li><a href="https://github.com/ctdk/knife-shove/releases/tag/v0.6.0">knife-shove v0.6.0 &ndash; Helmwige! Hier!</a></li>
</ul>


<p>Astute readers may recognize the releases&#8217; codenames as the opening lines of <a href="https://www.youtube.com/watch?v=cg0rmuoqo7U">Act III of <i>Die Walküre</i></a>.</p>

<p>Shovey&rsquo;s included with goiardi. Schob is the shovey client that gets installed on the nodes that will run jobs, and knife-shove is a knife plugin forked from knife-push to manage shovey jobs. The <a href="https://github.com/ctdk/goiardi/blob/master/README.md#shovey">goiardi shovey docs</a>, the <a href="https://github.com/ctdk/schob/blob/master/README.md">schob README</a>, and the <a href="https://github.com/ctdk/knife-shove/blob/master/README.rdoc">knife-shove README</a> have a bunch of documentation on how to use shovey.</p>

<p>Nice, functional cookbooks for shovey and goiardi are also coming. There is a <a href="https://github.com/ctdk/shovey-jobs">shovey-jobs</a> cookbook already, but it only supports Debian. Other platforms are being added, and will be ready soon.</p>

<p>Also coming reasonably soon are organizations and RBAC (it&rsquo;s finally time), and revamping the documentation. The README has gotten too long and unweildy. It will be split apart, reorganized, and expanded where needed, while the godocs for goiardi will stop being a mirror of the README and focus more on development and internals.</p>

<p>See you at the Summit!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/09/24/goiardi-plus-shovey-in-final-prerelease-stage/">Goiardi + Shovey in Final Prerelease Stage</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-24T21:38:01-07:00" pubdate data-updated="true">Sep 24<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Goiardi 0.8.0 is in the final stages of release engineering before its official release. This, of course, is the release that introduces shovey, the goiardi facility for running jobs on client nodes without having to do a full chef-client run.</p>

<p><a href="https://github.com/ctdk/goiardi/releases/tag/v0.8.0-pre3">0.8.0-pre3</a> should be the last prerelease version of goiardi 0.8.0. It goes hand in hand with <a href="https://github.com/ctdk/schob/releases/tag/v0.1.0-pre2">schob 0.1.0pre2</a>, now with updated documentation, and <a href="https://github.com/ctdk/knife-shove/releases/tag/v0.6.0-pre1">knife-shove 0.6.0-pre1</a>. The <a href="https://github.com/ctdk/shovey-jobs/releases/tag/v0.0.3">shovey-jobs</a> cookbook for setting up shovey on a node is important too, although it currently only works on Debian systems.</p>

<p>Documentation for all the pieces of shovey are available. The <a href="https://github.com/ctdk/goiardi/tree/serfing#shovey">shovey docs in goiardi</a> give an overview, and there&rsquo;s some <a href="https://github.com/ctdk/goiardi/blob/serfing/shovey_api.md">shovey API documentation</a> as well. There&rsquo;s <a href="https://github.com/ctdk/knife-shove/blob/tests/README.rdoc">knife-shove documentation</a> and <a href="https://github.com/ctdk/schob/blob/master/README.md">schob (the shovey client) documentation</a> available in their respective repositories as well.</p>

<p>Barring any complications, a formal release should be coming in the next couple of days.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/09/05/another-shovey-preview-the-shovey-jobs-cookbook/">Another Shovey Preview: The Shovey-Jobs Cookbook</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-05T19:58:15-07:00" pubdate data-updated="true">Sep 5<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Shovey still isn&rsquo;t finished, but it&rsquo;s come a long ways. To make it easier to play with and find potential issues, I&rsquo;ve released a <a href="https://github.com/ctdk/shovey-jobs">shovey-jobs cookbook</a> to install and configure shovey on a node.</p>

<p>It&rsquo;s a preliminary cookbook, but since shovey&rsquo;s pretty preliminary still I&rsquo;m OK with that. To use the shovey-jobs cookbook, you&rsquo;ll need to set goiardi and the knife-shove plugin up as explained in <a href="http://ctdk.github.io/goiardi/blog/2014/08/24/a-preview-of-shovey/">this previous post on shovey</a> first. Goiardi still only works with shovey in in-memory mode; the SQL support for shovey hasn&rsquo;t been finished yet. After goiardi and serf on the goiardi server are set up, spin up a node and run the shovey-jobs cookbook on it, following the instructions in the <a href="https://github.com/ctdk/shovey-jobs/blob/master/README.md">shovey-jobs README</a>. This cookbook has only been tested on Debian, but it may work with Ubuntu as well. At the moment it&rsquo;s unlikely to work with RHEL and its derivatives or other operating systems, mostly because the init script is Debian specific.</p>

<p>This cookbook depends on having the serf and golang cookbooks uploaded and in the node&rsquo;s run list. Serf may need some extra configuration to work correctly; I had to add this to the test node&rsquo;s attributes for it to work right.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"serf" =&gt; {
</span><span class='line'>    "agent" =&gt; { 
</span><span class='line'>      "node_name" =&gt; "goiardi-test.local",
</span><span class='line'>      "start_join" =&gt; [ "10.250.55.108" ],
</span><span class='line'>      "advertise" =&gt; "10.34.10.15"
</span><span class='line'>    }
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p>The main serf points are that the serf node&rsquo;s name needs to be the same as the chef client name on the node, it needs to join the same serf cluster as goiardi&rsquo;s serf agent is running on, and it needs to advertise the correct address. The last one came up in testing for me because goiardi was running on my dev box, while the shovey node&rsquo;s serf was advertising the internal vagrant address rather than the shared network address. That should be enough to get you going running commands with shovey. See the <a href="https://github.com/ctdk/knife-shove/blob/master/README.rdoc">knife-shove docs</a> for possible commands there.</p>

<p>On another note, there&rsquo;s some documentation now for the <a href="https://github.com/ctdk/goiardi/blob/serfing/shovey_api.md">shovey API</a>. The new thing there is how the shovey client now streams job output back to the server, and the server can in turn stream it to a client. Unfortunately the knife-shove plugin does not yet allow you to watch the job output stream by, but it&rsquo;s on the list of things to do before the formal release.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/08/24/a-preview-of-shovey/">A Preview of Shovey</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-24T22:07:42-07:00" pubdate data-updated="true">Aug 24<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The long promised &ldquo;shovey&rdquo; jobs for goiardi, a serf-based way to push commands out to nodes, is finally ready for a preview. There&rsquo;s still some loose ends to pull together, like saving job status on the client so if it&rsquo;s interrupted it can report that fact back to the server and making the goiardi end work with MySQL and Postgres, but it&rsquo;s ready to play with.</p>

<p>To try playing with it, you&rsquo;ll need <a href="https://github.com/ctdk/schob">schob</a>, the shovey client, and <a href="https://github.com/ctdk/knife-shove">knife-shove</a>, the knife plugin to manage shovey jobs.</p>

<p>As explained in the schob README:</p>

<blockquote><ol>
<li>Checkout the &ldquo;serfing&rdquo; branch from goiardi</li>
<li>Create an RSA keypair for signing shovey requests</li>
<li>Install serf and run it as &ldquo;serf agent&rdquo;</li>
<li>Run goiardi in in-memory mode (at this writing, MySQL and Postgres in goiardi don&rsquo;t support shovey yet) with these extra options: <code>--use-serf --use-shovey --sign-priv-key=/path/to/private.key --sign-pub-key=/path/to/public.key</code></li>
<li>Install knife-shove from <a href="https://github.com/ctdk/knife-shove">https://github.com/ctdk/knife-shove</a></li>
<li>Set up the node in goiardi you want to test shovey on. I&rsquo;ve been using the computer I do my usual goiardi dev work for most of it.</li>
<li>Install schob the usual go way</li>
<li>Note where the testing whitelist file is (probably somewhere like ~/go/src/github.com/ctdk/schob/test/whitelist.json).</li>
<li>Run schob like so: <code>schob -VVVV -e http://chef-server.local:4545 -n node-name.local -k /path/to/node.key -w /path/to/schob/test/whitelist.json -p /path/to/public.key --serf-addr=127.0.0.1:7373</code></li>
</ol>


<p>Run schob with <code>-h</code> to see all current options.</p></blockquote>

<p>Cookbooks for setting this all up and better documentation are coming, including documenting the HTTP and serf APIs for communicating with the server and client. The HTTP API is broadly similar to the Chef Pushy API, but not identical. Everything about shovey is still subject to change until it&rsquo;s officially released, but it&rsquo;s ready to play with now. Suggestions and comments are, of course, welcome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/08/09/goiardi-version-0-dot-7-2-the-yak-of-seville/">Goiardi Version 0.7.2 - the Yak of Seville</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-09T16:01:06-07:00" pubdate data-updated="true">Aug 9<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/ctdk/goiardi/releases/tag/v0.7.2">Goiardi version 0.7.2</a> is a minor yak shaving release that there isn&rsquo;t a lot to say about. The CHANGELOG pretty much sums it up:</p>

<ul>
<li>Remove a newline in a debug statement, courtesy of <a href="https://github.com/spheromak">@spheromak</a>.</li>
<li>Also per <a href="https://github.com/spheromak">@spheromak</a>&rsquo;s suggestion, fixed some possible race conditions revealed by building goiardi with the <code>-race</code> flag and running chef-pedant against it.</li>
<li>Edit doc.go slightly to make godocs more attractive.</li>
</ul>


<p>Elsewhere, shovey work continues and comes closer to completion.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/07/29/goiardi-version-0-dot-7-1-constant-manatee-attacks/">Goiardi Version 0.7.1 - Constant Manatee Attacks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-29T22:32:13-07:00" pubdate data-updated="true">Jul 29<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The media refuses to report on this scourge afflicting the Florida coast, which is why you never hear about it.</p>

<p>&ldquo;Shovey&rdquo; is chugging along on a fast pace, but in the meantime a couple of issues came up that I thought deserved attention. Goiardi <a href="https://github.com/ctdk/goiardi/releases/tag/v0.7.1">version 0.7.1</a> is a minor release, addressing two relatively small issues.</p>

<p>First, this release adds options for configuring the db pool size and max number of connections. It was happening automagically before, but I was always a bit uneasy about that. Until last night, though, I kept missing how to set that in the documentation for <code>database/sql</code>.</p>

<p>Second, for cookbook files stored locally (which is currently all of them), goiardi will now set the URL of the resource to use the current configured hostname. This was brought to my attention because someone had uploaded a bunch of cookbooks, changed the hostname and port and turned on SSL, and had the URLs break. It takes a specific chain of events to see the problem, which is why it had gone unnoticed up to this point.</p>

<p>From the CHANGELOG:</p>

<ul>
<li>Add &mdash;db-pool-size and &mdash;max-connections options for configuring the number
of idle db connections kept around and the maximum number of db connections
to make to the server. It isn&rsquo;t particularly useful if you&rsquo;re not using one
of the SQL backends.</li>
<li>For locally stored cookbook files (which is currently all of them), goiardi
now generates the URL to the resource from the currently configured
hostname. This fixes an issue where if you uploaded a cookbook and then
changed the goairdi server&rsquo;s hostname, the URLs to download cookbooks would
break.</li>
</ul>


<p>Other than that, there&rsquo;s nothing else new in this release.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/goiardi/blog/2014/07/21/goiardi-version-0-dot-7-0-orphans-of-the-sky/">Goiardi Version 0.7.0 - Orphans of the Sky</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-21T22:40:32-07:00" pubdate data-updated="true">Jul 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In case you haven&rsquo;t read it, <em><a href="http://en.wikipedia.org/wiki/Orphans_of_the_Sky">Orphans of the Sky</a></em> is a novel by Robert A. Heinlein about a generation ship floating through space where the people on board have forgotten that they are on a space ship. It&rsquo;s pretty good, but more importantly the name of the first of the two novellas that make up the novel is titled &ldquo;Universe&rdquo;. The title of the second part, &ldquo;Common Sense&rdquo;, became relevant after I really dug into making this release for reasons that will soon become clear.</p>

<p>While it ended up being a bigger deal than I expected it to be, I am pleased to announce the release of goiardi <a href="https://github.com/ctdk/goiardi/releases/tag/v0.7.0">version 0.7.0</a>.</p>

<p>I took what I thought would be a brief detour from my current work on the serf integration and &ldquo;shovey&rdquo; stuff for goiardi to implement <a href="https://github.com/opscode/chef-rfc/blob/master/rfc014-universe-endpoint.md">Chef RFC 014</a> real quick like, which I had been considering doing even before the RFC came along. I had been planning on making this a small release numbered 0.6.1, but then after I proposed a mechanism for caching the universe endpoint it was suggested in the RFC discussion that I see how goiardi performed with the full load of cookbooks in the supermarket before jumping the gun and adding caching before it was necessarily needed.</p>

<p>It turned out that will over 6,000 cookbooks the universe endpoint ran like a dog. Ultimately the problem boiled down to using gob to encode the complex data structures in cookbooks, nodes, etc. in the database. Generally gob encoding in golang is faster than using JSON, but in this particular case JSON is actually faster. The &ldquo;common sense&rdquo; thing to do was to change how those complex structures are stored in the database, even though it&rsquo;s a bit of a brutal change. Sometimes, though, you have to bite the bullet and do the thing that sucks. It&rsquo;s ended up working nicely, however; the postgres implementation is now able to make use of the json type and the json functions built into Postgres. Before switching from gob to json, serving <code>/universe</code> with over 6200 cookbooks took over 3 seconds with Postgres or MySQL, but afterwards Postgres can serve it in roughly 325 milliseconds. MySQL isn&rsquo;t able to take advantage of the Postgres-specific json functionality, but it still went down to 1 second, so that&rsquo;s a marked improvement. Using the in-memory (with or without file backing) takes about 1.2 seconds. I&rsquo;m willing to take this; if you have that many cookbooks and can&rsquo;t wait a second for <code>/universe</code>, you may want to use Postgres for your data store.</p>

<p>From the CHANGELOG:</p>

<ul>
<li>Add /universe API endpoint, per
<a href="https://github.com/opscode/chef-rfc/blob/master/rfc014-universe-endpoint.md.">https://github.com/opscode/chef-rfc/blob/master/rfc014-universe-endpoint.md.</a></li>
<li>Make file uploading a little more forgiving.</li>
<li>Make validating some cookbook metadata more forgiving, to bring goiardi&rsquo;s
validations in line with erchef.</li>
<li>Added some functions to make listing all cookbooks and recipes on the
server faster and move the logic into the cookbook package.</li>
<li><p>Breaking DB change: with both MySQL and Postgres, the way data structures
for cookbooks, nodes, etc. has changed from gob encoding to using JSON. This
obviously breaks existing items in the database, so the following steps must
be followed by users using either SQL backend for data storage:</p>

<ul>
<li>Export their goiardi server&rsquo;s data with the <code>-x</code> flag.</li>
<li>Either revert all changes to the db with sqitch, then redeploy, or drop
the database manually and recreate it from either the sqitch patches or
the full table dump of the release (provided starting with 0.7.0)</li>
<li>Reload the goiardi data with the <code>-m</code> flag.
See the README or the godocs for more information.</li>
</ul>
</li>
</ul>


<p>More documentation on the universe endpoint in goiardi is <a href="https://github.com/ctdk/goiardi#berks-universe-endpoint">available in the README</a>. Specific information on upgrading is also in the README in the <a href="https://github.com/ctdk/goiardi#upgrading">UPGRADING</a> section.</p>

<p>Back to the serf/shovey stuff, then.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/goiardi/blog/page/2/">&larr; Older</a>
    
    <a href="/goiardi/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Goiardi</h1>
  <p><a href="https://github.com/ctdk/goiardi">Goiardi</a> is an implementation of <a href="http://www.getchef.com/chef/">the Chef server</a> written in <a href="http://golang.org">Go</a>. It can run entirely in memory (with optional persistence on disk) or can use MySQL or Postgres as a backend, is self-contained, and runs on many different platforms.</p>
</section>
<section>
  <h1>Additional Resources</h1>
   <ul>
    <li><a href="https://github.com/ctdk/goiardi-schema">goiardi-schema</a>: The SQL schema, managed with sqitch, for goiardi.</li>
    <li><a href="https://github.com/marpaia/chef-golang">chef-golang</a>: A golang chef client library.</li>
    <li><a href="https://github.com/go-chef">go-chef</a>: A number of chef libs and utilities written in Go.</li>
    <li><a href="http://docs.opscode.com/">docs.opscode.com</a>: The official Chef documentation. The chef client programs are, of course, needed to do much of anything with goiardi.</li>
    <li><a href="https://github.com/opscode/chef-zero">chef-zero</a>: Another in-memory chef server.</li>
    <li><a href="https://github.com/opscode/erchef">erchef</a>: The official Chef server, written in Erlang.</li>
    <li><a href="https://github.com/opscode/omnibus-chef-server">omnibus-chef-server</a>: Omnibus installer for erchef.</li>
    <li><a href="https://github.com/ctdk/knife-goiardi-event-log">knife-goiardi-event-log</a>: Knife plugin for the goiardi event log.</li>
    <li><a href="https://github.com/ctdk/knife-goiardi-reporting">knife-goiardi-reporting</a>: Forked knife plugin for goiardi&#8217;s reporting facilities.</li>
    <li><a href="https://github.com/ctdk/schob">schob</a>: The goiardi shovey client.</li>
    <li><a href="https://github.com/ctdk/knife-shove">knife-shove</a>: Knife plugin forked from knife-push for managing shovey jobs.</li>
    <li><a href="https://github.com/ctdk/shovey-jobs">shovey-jobs</a>: chef cookbook for installing and configuring shovey on a node. In-progress.</li>
   </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/goiardi/blog/2014/12/12/goiardi-has-a-new-home/">Goiardi Has a New Home</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/11/23/goiardi-version-0-dot-8-2-can-shaped-cranberry-sauce/">Goiardi Version 0.8.2 - Can-shaped Cranberry Sauce</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/10/15/goiardi-version-0-dot-8-1-and-schob-version-0-dot-1-1-hand-of-ishtar-hand-of-nergal/">Goiardi Version 0.8.1 and Schob Version 0.1.1 - Hand of Ishtar, Hand of Nergal</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/09/29/goiardi-version-0-dot-8-0-plus-shovey-hojotoho-hojotoho/">Goiardi Version 0.8.0 (Plus Shovey) - Hojotoho! Hojotoho!</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/09/24/goiardi-plus-shovey-in-final-prerelease-stage/">Goiardi + Shovey in Final Prerelease Stage</a>
      </li>
    
  </ul>
</section>




<a class="twitter-timeline" href="https://twitter.com/goiardi" data-widget-id="421775961479057409">Tweets by @goiardi</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jeremy Bingham -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span><br />
  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/us/80x15.png" /></a> Unless otherwise specified, all content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States License</a>.<br />
  <a href="http://www.getchef.com">Chef</a> is &copy; 2008-2014, Chef (neé Opscode).
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'goiardi';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
