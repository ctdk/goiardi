
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Goiardi Version 0.7.0 - Orphans of the Sky - Goiardi</title>
  <meta name="author" content="Jeremy Bingham">

  
  <meta name="description" content="In case you haven&rsquo;t read it, Orphans of the Sky is a novel by Robert A. Heinlein about a generation ship floating through space where the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ctdk.github.io/goiardi/blog/2014/07/21/goiardi-version-0-dot-7-0-orphans-of-the-sky">
  <link href="/goiardi/favicon.png" rel="icon">
  <link href="/goiardi/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/goiardi/atom.xml" rel="alternate" title="Goiardi" type="application/atom+xml">
  <script src="/goiardi/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/goiardi/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6397614-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/goiardi/">Goiardi</a></h1>
  
    <h2>The one-eyed fanged yak is becoming on you.</h2>
  
  </div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/goiardi/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ctdk.github.io/goiardi" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/goiardi/">Blog</a></li>
  <li><a href="/goiardi/blog/archives">Archives</a></li>
  <li><a href="/goiardi/docs">Documentation</a></li>
  <li><a href="https://github.com/ctdk/goiardi">Source</a></li>
  <li><a href="http://time.to.pullthepl.ug">Time To Pull The Plug</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Goiardi Version 0.7.0 - Orphans of the Sky</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-21T22:40:32-07:00" pubdate data-updated="true">Jul 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In case you haven&rsquo;t read it, <em><a href="http://en.wikipedia.org/wiki/Orphans_of_the_Sky">Orphans of the Sky</a></em> is a novel by Robert A. Heinlein about a generation ship floating through space where the people on board have forgotten that they are on a space ship. It&rsquo;s pretty good, but more importantly the name of the first of the two novellas that make up the novel is titled &ldquo;Universe&rdquo;. The title of the second part, &ldquo;Common Sense&rdquo;, became relevant after I really dug into making this release for reasons that will soon become clear.</p>

<p>While it ended up being a bigger deal than I expected it to be, I am pleased to announce the release of goiardi <a href="https://github.com/ctdk/goiardi/releases/tag/v0.7.0">version 0.7.0</a>.</p>

<p>I took what I thought would be a brief detour from my current work on the serf integration and &ldquo;shovey&rdquo; stuff for goiardi to implement <a href="https://github.com/opscode/chef-rfc/blob/master/rfc014-universe-endpoint.md">Chef RFC 014</a> real quick like, which I had been considering doing even before the RFC came along. I had been planning on making this a small release numbered 0.6.1, but then after I proposed a mechanism for caching the universe endpoint it was suggested in the RFC discussion that I see how goiardi performed with the full load of cookbooks in the supermarket before jumping the gun and adding caching before it was necessarily needed.</p>

<p>It turned out that will over 6,000 cookbooks the universe endpoint ran like a dog. Ultimately the problem boiled down to using gob to encode the complex data structures in cookbooks, nodes, etc. in the database. Generally gob encoding in golang is faster than using JSON, but in this particular case JSON is actually faster. The &ldquo;common sense&rdquo; thing to do was to change how those complex structures are stored in the database, even though it&rsquo;s a bit of a brutal change. Sometimes, though, you have to bite the bullet and do the thing that sucks. It&rsquo;s ended up working nicely, however; the postgres implementation is now able to make use of the json type and the json functions built into Postgres. Before switching from gob to json, serving <code>/universe</code> with over 6200 cookbooks took over 3 seconds with Postgres or MySQL, but afterwards Postgres can serve it in roughly 325 milliseconds. MySQL isn&rsquo;t able to take advantage of the Postgres-specific json functionality, but it still went down to 1 second, so that&rsquo;s a marked improvement. Using the in-memory (with or without file backing) takes about 1.2 seconds. I&rsquo;m willing to take this; if you have that many cookbooks and can&rsquo;t wait a second for <code>/universe</code>, you may want to use Postgres for your data store.</p>

<p>From the CHANGELOG:</p>

<ul>
<li>Add /universe API endpoint, per
<a href="https://github.com/opscode/chef-rfc/blob/master/rfc014-universe-endpoint.md.">https://github.com/opscode/chef-rfc/blob/master/rfc014-universe-endpoint.md.</a></li>
<li>Make file uploading a little more forgiving.</li>
<li>Make validating some cookbook metadata more forgiving, to bring goiardi&rsquo;s
validations in line with erchef.</li>
<li>Added some functions to make listing all cookbooks and recipes on the
server faster and move the logic into the cookbook package.</li>
<li><p>Breaking DB change: with both MySQL and Postgres, the way data structures
for cookbooks, nodes, etc. has changed from gob encoding to using JSON. This
obviously breaks existing items in the database, so the following steps must
be followed by users using either SQL backend for data storage:</p>

<ul>
<li>Export their goiardi server&rsquo;s data with the <code>-x</code> flag.</li>
<li>Either revert all changes to the db with sqitch, then redeploy, or drop
the database manually and recreate it from either the sqitch patches or
the full table dump of the release (provided starting with 0.7.0)</li>
<li>Reload the goiardi data with the <code>-m</code> flag.
See the README or the godocs for more information.</li>
</ul>
</li>
</ul>


<p>More documentation on the universe endpoint in goiardi is <a href="https://github.com/ctdk/goiardi#berks-universe-endpoint">available in the README</a>. Specific information on upgrading is also in the README in the <a href="https://github.com/ctdk/goiardi#upgrading">UPGRADING</a> section.</p>

<p>Back to the serf/shovey stuff, then.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jeremy Bingham</span></span>

      








  


<time datetime="2014-07-21T22:40:32-07:00" pubdate data-updated="true">Jul 21<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/goiardi/blog/categories/berks-api/'>berks-api</a>, <a class='category' href='/goiardi/blog/categories/berkshelf/'>berkshelf</a>, <a class='category' href='/goiardi/blog/categories/goiardi/'>goiardi</a>, <a class='category' href='/goiardi/blog/categories/releases/'>releases</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/goiardi/blog/2014/07/01/goiardi-version-0-dot-6-0-order-of-the-elephant/" title="Previous Post: Goiardi version 0.6.0 - Order of the Elephant">&laquo; Goiardi version 0.6.0 - Order of the Elephant</a>
      
      
        <a class="basic-alignment right" href="/goiardi/blog/2014/07/29/goiardi-version-0-dot-7-1-constant-manatee-attacks/" title="Next Post: goiardi version 0.7.1 - Constant Manatee Attacks">goiardi version 0.7.1 - Constant Manatee Attacks &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Goiardi</h1>
  <p><a href="https://github.com/ctdk/goiardi">Goiardi</a> is an implementation of <a href="http://www.getchef.com/chef/">the Chef server</a> written in <a href="http://golang.org">Go</a>. It can run entirely in memory (with optional persistence on disk) or can use MySQL or Postgres as a backend, is self-contained, and runs on many different platforms.</p>
</section>
<section>
  <h1>Additional Resources</h1>
   <ul>
    <li><a href="https://github.com/ctdk/goiardi-schema">goiardi-schema</a>: The SQL schema, managed with sqitch, for goiardi.</li>
    <li><a href="https://github.com/marpaia/chef-golang">chef-golang</a>: A golang chef client library.</li>
    <li><a href="https://github.com/go-chef">go-chef</a>: A number of chef libs and utilities written in Go.</li>
    <li><a href="http://docs.opscode.com/">docs.opscode.com</a>: The official Chef documentation. The chef client programs are, of course, needed to do much of anything with goiardi.</li>
    <li><a href="https://github.com/opscode/chef-zero">chef-zero</a>: Another in-memory chef server.</li>
    <li><a href="https://github.com/opscode/erchef">erchef</a>: The official Chef server, written in Erlang.</li>
    <li><a href="https://github.com/opscode/omnibus-chef-server">omnibus-chef-server</a>: Omnibus installer for erchef.</li>
    <li><a href="https://github.com/ctdk/knife-goiardi-event-log">knife-goiardi-event-log</a>: Knife plugin for the goiardi event log.</li>
    <li><a href="https://github.com/ctdk/knife-goiardi-reporting">knife-goiardi-reporting</a>: Forked knife plugin for goiardi's reporting facilities.</li>
    <li><a href="https://github.com/ctdk/schob">schob</a>: The goiardi shovey client.</li>
    <li><a href="https://github.com/ctdk/knife-shove">knife-shove</a>: Knife plugin forked from knife-push for managing shovey jobs.</li>
    <li><a href="https://github.com/ctdk/shovey-jobs">shovey-jobs</a>: chef cookbook for installing and configuring shovey on a node. In-progress.</li>
   </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/goiardi/blog/2014/11/23/goiardi-version-0-dot-8-2-can-shaped-cranberry-sauce/">Goiardi Version 0.8.2 - Can-shaped Cranberry Sauce</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/10/15/goiardi-version-0-dot-8-1-and-schob-version-0-dot-1-1-hand-of-ishtar-hand-of-nergal/">Goiardi Version 0.8.1 and Schob Version 0.1.1 - Hand of Ishtar, Hand of Nergal</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/09/29/goiardi-version-0-dot-8-0-plus-shovey-hojotoho-hojotoho/">Goiardi Version 0.8.0 (Plus Shovey) - Hojotoho! Hojotoho!</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/09/24/goiardi-plus-shovey-in-final-prerelease-stage/">Goiardi + Shovey in Final Prerelease Stage</a>
      </li>
    
      <li class="post">
        <a href="/goiardi/blog/2014/09/05/another-shovey-preview-the-shovey-jobs-cookbook/">Another Shovey Preview: The Shovey-Jobs Cookbook</a>
      </li>
    
  </ul>
</section>




<a class="twitter-timeline" href="https://twitter.com/goiardi" data-widget-id="421775961479057409">Tweets by @goiardi</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jeremy Bingham -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span><br />
  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/us/80x15.png" /></a> Unless otherwise specified, all content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States License</a>.<br />
  <a href="http://www.getchef.com">Chef</a> is &copy; 2008-2014, Chef (ne√© Opscode).
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'goiardi';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ctdk.github.io/goiardi/blog/2014/07/21/goiardi-version-0-dot-7-0-orphans-of-the-sky/';
        var disqus_url = 'http://ctdk.github.io/goiardi/blog/2014/07/21/goiardi-version-0-dot-7-0-orphans-of-the-sky/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
